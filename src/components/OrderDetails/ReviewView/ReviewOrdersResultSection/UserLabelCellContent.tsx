import { useEffect, useState } from 'react';
import QRCode from 'qrcode';

function UserLabelCellContent({
  companyName,
  partnerName,
  mealDate,
  participantName,
  foodName,
  ratingUrl,
  note,
}: {
  companyName: string;
  partnerName: string;
  mealDate: string;
  participantName: string;
  foodName: string;
  ratingUrl: string;
  note?: string;
}) {
  const [qrCodeDataUrl, setQrCodeDataUrl] = useState('');

  useEffect(() => {
    QRCode.toDataURL(ratingUrl, {
      small: true,
      margin: 2,
      scale: 4,
      errorCorrectionLevel: 'L',
    }).then((url: string) => {
      setQrCodeDataUrl(url);
    });
  }, [ratingUrl]);

  return (
    <div className="relative w-full h-full gap-0 p-[4mm] ">
      <div className="flex items-center justify-between w-full">
        <div className="w-[calc(100%-30mm)] h-[14mm] overflow-hidden">
          <div
            className="text-[2.8mm] h-[4.75mm] overflow-hidden"
            style={{
              fontFamily: 'Quicksand',
              lineHeight: 1.0,
            }}>
            {companyName}
          </div>
          <div
            className="text-[2.8mm] italic h-[4.75mm] overflow-hidden"
            style={{
              fontFamily: 'Quicksand',
              lineHeight: 1.0,
            }}>
            {partnerName}
          </div>
          <div
            className="text-[2.8mm] font-semibold h-[4.5mm] overflow-hidden"
            style={{
              fontFamily: 'Quicksand',
              lineHeight: 1.0,
            }}>
            {mealDate}
          </div>
        </div>
        <div className="mx-auto flex gap-1 w-[28mm] justify-end">
          <p
            className="m-0 text-right text-[2.6mm]"
            style={{
              fontFamily: 'Quicksand',
            }}>
            <span className="text-nowrap">Mời bạn</span>
            <br /> <span className="text-nowrap">đánh giá</span>
          </p>
          <div className="relative ">
            <div className="absolute bottom-[0mm] left-[-7mm] w-[8mm] h-[8mm]">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                xmlnsXlink="http://www.w3.org/1999/xlink"
                width="100%"
                zoomAndPan="magnify"
                viewBox="0 0 198.75 141.749996"
                height="100%"
                preserveAspectRatio="xMidYMid meet"
                version="1.0">
                <defs>
                  <clipPath id="f1b7b11c46">
                    <path
                      d="M 7 40.140625 L 190 40.140625 L 190 90 L 7 90 Z M 7 40.140625 "
                      clip-rule="nonzero"
                    />
                  </clipPath>
                </defs>
                <g clip-path="url(#f1b7b11c46)">
                  <path
                    fill="#000000"
                    d="M 9.890625 41.652344 C 9.796875 41.78125 9.785156 41.925781 9.84375 42.078125 C 9.476562 42.5 8.628906 42.171875 8.488281 42.949219 C 7.246094 44.183594 7.714844 45.445312 8.453125 46.695312 C 10.527344 50.1875 13.125 53.269531 15.914062 56.195312 C 25.914062 66.667969 37.640625 74.566406 50.886719 80.464844 C 74.011719 90.773438 97.878906 92.199219 122.34375 87.164062 C 133.6875 84.832031 144.410156 80.5625 154.9375 75.792969 C 161.121094 72.988281 167.117188 69.824219 173.195312 66.800781 C 173.367188 66.597656 173.53125 66.394531 173.699219 66.1875 C 174 66.175781 174.335938 66.074219 174.582031 66.183594 C 174.582031 66.183594 174.582031 66.183594 174.585938 66.1875 C 174.777344 66.277344 174.648438 66.550781 174.429688 66.660156 C 173.25 69.046875 171.605469 71.105469 169.855469 73.078125 C 168.652344 74.429688 167.589844 75.828125 166.960938 77.53125 C 164.355469 80.417969 164.265625 83.507812 166.585938 86.195312 C 173.824219 83.40625 178.238281 77.667969 182.246094 71.46875 C 183.742188 69.164062 185.386719 66.964844 186.996094 64.742188 C 190.855469 59.421875 189.996094 59.976562 187.863281 55.070312 C 187.382812 53.972656 186.660156 53.003906 185.84375 52.117188 C 185.542969 51.789062 185.234375 51.515625 184.765625 51.515625 C 184.152344 50.296875 183.003906 50.28125 181.886719 50.324219 C 178.5625 50.445312 175.25 50.609375 171.925781 50.757812 C 171.230469 50.378906 170.507812 50.492188 169.785156 50.644531 C 169.101562 50.234375 168.375 50.363281 167.652344 50.460938 C 167.214844 50.089844 166.667969 50.226562 166.171875 50.160156 C 159.425781 49.210938 152.882812 47.519531 146.648438 44.714844 C 146.179688 44.503906 145.695312 44.332031 145.214844 44.144531 C 144.648438 43.910156 144.007812 43.644531 143.558594 44.175781 C 143.21875 44.578125 143.3125 45.308594 143.613281 45.644531 C 144.9375 47.128906 145.132812 49.183594 146.285156 50.730469 C 146.796875 51.421875 147.550781 51.84375 148.320312 52.261719 C 154.246094 55.5 160.582031 57.601562 167.152344 59.0625 C 167.738281 59.191406 168.359375 59.230469 168.898438 59.476562 C 169.527344 59.761719 169.347656 60.296875 169.035156 60.765625 C 168.351562 60.683594 167.867188 60.957031 167.554688 61.550781 C 166.921875 61.597656 166.308594 61.695312 165.984375 62.355469 C 165.828125 62.28125 165.726562 62.328125 165.679688 62.492188 C 165.070312 62.519531 164.511719 62.640625 164.183594 63.234375 C 163.777344 63.34375 163.347656 63.398438 162.964844 63.578125 C 158.769531 65.5 154.609375 67.492188 150.394531 69.367188 C 146.566406 71.074219 142.691406 72.65625 138.839844 74.285156 C 137.765625 74.59375 136.691406 74.859375 135.640625 75.207031 C 125.394531 78.527344 114.902344 80.566406 104.132812 81.03125 C 100.285156 81.195312 96.4375 81.242188 92.589844 81.339844 C 91.863281 80.929688 91.109375 81.09375 90.355469 81.242188 C 89.664062 80.832031 88.949219 80.976562 88.226562 81.113281 C 87.597656 80.675781 86.917969 80.859375 86.242188 80.929688 C 85.851562 80.601562 85.421875 80.621094 84.980469 80.777344 C 84.828125 80.671875 84.679688 80.664062 84.523438 80.765625 C 84.085938 80.410156 83.546875 80.535156 83.054688 80.453125 C 80.628906 80.035156 78.136719 80.054688 75.757812 79.339844 C 75.546875 79.539062 74.84375 79.640625 75.703125 80 C 76.273438 80.246094 76.308594 80.417969 76.152344 80.5625 C 76.015625 80.683594 75.738281 80.785156 75.53125 80.886719 C 67.90625 79.332031 60.558594 76.878906 53.371094 73.9375 C 52.730469 73.601562 52.082031 73.269531 51.441406 72.933594 C 47.605469 70.9375 43.765625 68.9375 39.933594 66.945312 C 39.859375 66.78125 39.75 66.671875 39.613281 66.613281 C 39.515625 66.570312 39.414062 66.550781 39.296875 66.550781 C 39.175781 66.285156 38.964844 66.160156 38.675781 66.167969 C 38.5625 65.894531 38.351562 65.773438 38.058594 65.785156 C 37.949219 65.507812 37.734375 65.382812 37.4375 65.398438 C 37.328125 65.117188 37.121094 64.980469 36.820312 65 C 36.71875 64.714844 36.515625 64.585938 36.214844 64.605469 L 36.207031 64.597656 C 36.113281 64.320312 35.90625 64.183594 35.613281 64.203125 L 35.601562 64.195312 C 35.417969 64.054688 35.21875 63.917969 35.015625 63.792969 L 34.992188 63.78125 C 34.898438 63.5 34.707031 63.363281 34.40625 63.378906 L 34.386719 63.363281 C 34.292969 63.085938 34.101562 62.949219 33.800781 62.960938 L 33.78125 62.949219 C 33.78125 62.949219 33.773438 62.941406 33.773438 62.941406 C 33.773438 62.941406 33.78125 62.949219 33.78125 62.949219 C 33.691406 62.664062 33.492188 62.527344 33.191406 62.539062 L 33.179688 62.53125 C 33.089844 62.246094 32.894531 62.109375 32.59375 62.125 L 32.585938 62.117188 C 32.492188 61.832031 32.292969 61.6875 31.992188 61.695312 C 30.246094 60.28125 28.507812 58.871094 26.761719 57.457031 C 25.621094 57.007812 24.835938 56.085938 23.957031 55.300781 C 23.992188 55.164062 24.054688 55.058594 24.128906 54.960938 C 24.242188 54.8125 24.394531 54.707031 24.597656 54.648438 C 24 53.984375 23.445312 53.277344 22.578125 52.929688 C 22.308594 52.847656 22.054688 52.730469 21.855469 52.511719 C 22.09375 52.648438 22.335938 52.792969 22.578125 52.929688 C 22.429688 52.675781 22.257812 52.457031 21.9375 52.503906 C 21.855469 52.0625 21.578125 51.796875 21.167969 51.632812 C 21.121094 51.347656 20.96875 51.167969 20.664062 51.15625 C 20.539062 50.882812 20.375 50.671875 20.054688 50.636719 C 20.015625 50.492188 19.941406 50.382812 19.789062 50.324219 C 19.320312 49.574219 18.71875 48.957031 17.96875 48.488281 C 17.605469 47.976562 17.257812 47.453125 16.664062 47.171875 C 16.554688 46.761719 16.222656 46.542969 15.914062 46.304688 C 14.496094 44.285156 12.714844 42.539062 11.632812 40.144531 C 11.039062 40.855469 10.042969 40.734375 9.890625 41.652344 Z M 165.769531 62.996094 C 165.761719 62.996094 165.761719 62.996094 165.753906 62.996094 C 165.753906 63.003906 165.761719 63.003906 165.761719 63.003906 C 165.753906 63.003906 165.746094 62.996094 165.746094 62.996094 C 165.746094 62.996094 165.753906 62.996094 165.753906 62.996094 C 165.753906 62.988281 165.753906 62.984375 165.746094 62.976562 C 165.761719 62.984375 165.761719 62.988281 165.769531 62.996094 Z M 32.484375 63.78125 C 32.523438 63.820312 32.566406 63.863281 32.605469 63.902344 C 32.59375 63.898438 32.578125 63.890625 32.566406 63.882812 C 32.523438 63.855469 32.484375 63.828125 32.441406 63.792969 C 32.449219 63.792969 32.464844 63.789062 32.484375 63.78125 Z M 39.890625 66.945312 C 39.890625 66.953125 39.882812 66.953125 39.882812 66.960938 C 39.871094 66.972656 39.863281 66.992188 39.851562 67.007812 L 39.804688 67.054688 L 39.882812 66.953125 C 39.882812 66.945312 39.878906 66.945312 39.878906 66.9375 C 39.878906 66.945312 39.882812 66.945312 39.890625 66.945312 Z M 32.230469 63.875 C 32.300781 63.847656 32.367188 63.820312 32.429688 63.800781 C 32.46875 63.828125 32.511719 63.855469 32.550781 63.882812 C 32.457031 63.835938 32.347656 63.828125 32.230469 63.875 Z M 32.816406 64.082031 C 32.867188 64.113281 32.914062 64.148438 32.953125 64.183594 C 32.953125 64.191406 32.960938 64.191406 32.960938 64.195312 C 32.914062 64.15625 32.867188 64.113281 32.816406 64.082031 Z M 11.195312 46.132812 C 11.1875 46.132812 11.179688 46.128906 11.175781 46.128906 C 11.175781 46.128906 11.167969 46.121094 11.167969 46.121094 C 11.167969 46.113281 11.160156 46.109375 11.160156 46.101562 C 11.175781 46.109375 11.179688 46.121094 11.195312 46.132812 Z M 11.828125 47.027344 C 11.828125 47.042969 11.828125 47.054688 11.84375 47.0625 C 11.84375 47.046875 11.828125 47.035156 11.828125 47.027344 Z M 21.414062 52.464844 C 21.367188 52.484375 21.316406 52.511719 21.269531 52.554688 C 21.261719 52.519531 21.257812 52.484375 21.25 52.449219 C 21.304688 52.457031 21.359375 52.457031 21.414062 52.464844 Z M 20.191406 50.957031 C 20.117188 50.902344 20.0625 50.820312 20.027344 50.71875 C 20.027344 50.71875 20.027344 50.71875 20.035156 50.71875 C 20.078125 50.8125 20.125 50.894531 20.191406 50.957031 Z M 20.191406 50.957031 "
                    fill-opacity="1"
                    fill-rule="nonzero"
                  />
                </g>
                <path
                  fill="#000000"
                  d="M 34.972656 63.78125 C 35.171875 63.917969 35.371094 64.046875 35.558594 64.183594 C 35.464844 63.898438 35.265625 63.765625 34.972656 63.78125 Z M 34.972656 63.78125 "
                  fill-opacity="1"
                  fill-rule="nonzero"
                />
              </svg>
            </div>
          </div>
          <img
            src={qrCodeDataUrl}
            className="w-[16mm] h-[16mm] min-w-[16mm] min-h-[16mm]"
            alt="QR Code"
          />
        </div>
      </div>

      <div className="flex items-center flex-col justify-center">
        <div
          className="w-full px-2 text-[4mm] font-semibold text-center min-h-[7mm] pb-[2.5mm] max-h-[11.5mm] overflow-hidden"
          style={{
            wordBreak: 'break-word',
            fontFamily: 'Reddit Sans',
            lineHeight: 1.1,
          }}>
          {participantName}
        </div>
        <div className="w-[12mm] h-[0.5mm] mt-[2mm] bg-stone-600"></div>
        <div
          className="text-[3.2mm] w-full px-[2mm] text-center font-semibold h-[9mm] overflow-hidden"
          style={{
            wordBreak: 'break-word',
            fontFamily: 'Reddit Sans',
            lineHeight: 1.1,
          }}>
          {foodName}
        </div>

        <div
          className="text-[3.3mm] w-full text-center font-light italic h-[5.5mm] overflow-hidden mt-[-2mm]"
          style={{
            wordBreak: 'break-word',
            fontFamily: 'Reddit Sans',
            lineHeight: 1,
          }}>
          {note}
        </div>
      </div>

      <i
        className="text-xs w-full text-center italic absolute bottom-[4mm] left-1/2 transform -translate-x-1/2"
        style={{
          fontFamily: 'Reddit Sans',
        }}>
        Chúc bạn ngon miệng!
      </i>
    </div>
  );
}
export default UserLabelCellContent;
